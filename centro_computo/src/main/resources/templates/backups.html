<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Backups - TecnoSolutions</title>
    <link rel="stylesheet" th:href="@{/style.css}">
    <link rel="stylesheet" th:href="@{/dashboard.css}">
    <link rel="stylesheet" th:href="@{/backups.css}">
</head>
<body class="dashboard-body">

<nav class="navbar">
    <div class="nav-brand">ğŸ–¥ï¸ TecnoSolutions</div>
    <div class="nav-menu">
        <a th:href="@{/monitoreo}" class="nav-link">ğŸ“Š Monitoreo</a>
        <a th:href="@{/process-management}" class="nav-link">âš™ï¸ GestiÃ³n de Procesos</a>
        <a th:href="@{/backups}" class="nav-link">ğŸ’¾ Backups</a>
        <a th:href="@{/database}" class="nav-link active">ğŸ—„ï¸ Base de Datos</a>
        <a th:href="@{/tickets}" class="nav-link">ğŸ« Tickets</a>
        <a th:href="@{/logout}" class="nav-link logout">ğŸšª Cerrar SesiÃ³n</a>
    </div>
</nav>

<div class="container dashboard-content">
    <h2 class="welcome-header">Sistema de Backup Automatizado</h2>

    <!-- Alertas -->
    <div id="alertsContainer"></div>

    <!-- Crear Backup - SOLO ADMIN -->
    <section class="monitoring-section" th:if="${userSession.isAdmin()}">
        <h3>ğŸ’¾ Crear Nuevo Backup</h3>
        <div class="monitoring-placeholder">
            <div class="backup-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="backupName">Nombre del Backup</label>
                        <input type="text"
                               id="backupName"
                               class="form-input"
                               placeholder="ej: Documentos_Importantes">
                    </div>

                    <div class="form-group">
                        <label for="sourcePath">Ruta del Directorio a Respaldar</label>
                        <input type="text"
                               id="sourcePath"
                               class="form-input"
                               placeholder="ej: C:\Users\Usuario\Documents">
                    </div>

                    <div class="form-group form-group-btn">
                        <button onclick="createBackup()" class="btn-create-backup">
                            ğŸ’¾ Crear Backup
                        </button>
                    </div>
                </div>
            </div>

            <!-- Progreso -->
            <div id="backupProgress" class="backup-progress" style="display: none;">
                <div class="progress-info">
                    <span>Creando backup...</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Lista de Backups - TODOS -->
    <section class="monitoring-section">
        <h3>ğŸ“¦ Backups Disponibles</h3>
        <div class="monitoring-placeholder">
            <div class="backup-actions">
                <button onclick="loadBackups()" class="btn-refresh">ğŸ”„ Actualizar</button>
                <span id="backupCount" class="backup-count">Cargando...</span>
            </div>

            <!-- Tabla de Backups (diseÃ±o compacto) -->
            <div class="table-container">
                <table class="backup-table">
                    <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>TamaÃ±o</th>
                        <th>Fecha</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody id="backupsTableBody">
                    <tr>
                        <td colspan="5" class="loading">Cargando backups...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Historial de Backups - ADMIN y TECNICO -->
    <section class="monitoring-section" th:if="${userSession.isAdmin() or userSession.isTechnician()}">
        <h3>ğŸ“‹ Historial de Operaciones</h3>
        <div class="monitoring-placeholder">
            <div class="table-container">
                <table class="log-table">
                    <thead>
                    <tr>
                        <th>Fecha/Hora</th>
                        <th>Nombre</th>
                        <th>Origen</th>
                        <th>Usuario</th>
                        <th>TamaÃ±o</th>
                        <th>Estado</th>
                    </tr>
                    </thead>
                    <tbody id="historyTableBody">
                    <tr>
                        <td colspan="6" class="loading">Cargando historial...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</div>

<!-- Modal de Detalles del Backup -->
<div id="detailsModal" class="modal">
    <div class="modal-content modal-details">
        <div class="modal-header">
            <h3>ğŸ“‹ Detalles del Backup</h3>
            <span class="close" onclick="closeDetailsModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="detail-info">
                <div class="detail-row">
                    <span class="detail-label">Nombre:</span>
                    <span id="detailName" class="detail-value"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">TamaÃ±o:</span>
                    <span id="detailSize" class="detail-value"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Fecha:</span>
                    <span id="detailDate" class="detail-value"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Ruta:</span>
                    <span id="detailPath" class="detail-value"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Estado:</span>
                    <span id="detailStatus" class="detail-value"></span>
                </div>
            </div>

            <div class="detail-actions">
                <button onclick="verifyFromDetails()" class="btn-action btn-verify">
                    ğŸ” Verificar Integridad
                </button>
                <button onclick="restoreFromDetails()" class="btn-action btn-restore">
                    â™»ï¸ Restaurar Backup
                </button>
                <button onclick="deleteFromDetails()" class="btn-action btn-delete">
                    ğŸ—‘ï¸ Eliminar Backup
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Restaurar Backup -->
<div id="restoreModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>â™»ï¸ Restaurar Backup</h3>
            <span class="close" onclick="closeRestoreModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Nombre del backup: <strong id="restoreBackupName"></strong></p>

            <div class="form-group">
                <label for="targetPath">Ruta de Destino</label>
                <input type="text"
                       id="targetPath"
                       class="form-input"
                       placeholder="ej: C:\Users\Usuario\Restaurados">
                <small class="form-hint">âš ï¸ Los archivos existentes serÃ¡n sobrescritos</small>
            </div>
        </div>
        <div class="modal-footer">
            <button onclick="closeRestoreModal()" class="btn-secondary">Cancelar</button>
            <button onclick="confirmRestore()" class="btn-primary">â™»ï¸ Restaurar</button>
        </div>
    </div>
</div>

<!-- Modal para Verificar Backup -->
<div id="verifyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ” VerificaciÃ³n de Integridad</h3>
            <span class="close" onclick="closeVerifyModal()">&times;</span>
        </div>
        <div id="verifyModalBody" class="modal-body">
            <div class="loading">Verificando integridad...</div>
        </div>
        <div class="modal-footer">
            <button onclick="closeVerifyModal()" class="btn-secondary">Cerrar</button>
        </div>
    </div>
</div>

<script th:src="@{/backups.js}"></script>

</body>
</html>